<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <meta name="color-scheme" content="light dark">

    

    
    <meta name="description" content="Quem trabalha no mercado financeiro brasileiro lida constantemente com uma praga que é a contagem de dias úteis.Não que seja difícil utilizar a contagem de dias úteis para fazer o apreçamento de instrumentos financeiros.A dificuldade é ter a contagem de dias úteis a mão e de maneira flexível, onde possamos, eventualmente, inserir ou remover feriados.Essa disponibilidade é a razão pela qual o Excel é tão utilizado.">
    <meta name="keywords" content="">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="bizdays - dias uteis no R"/>
<meta name="twitter:description" content="Quem trabalha no mercado financeiro brasileiro lida constantemente com uma praga que é a contagem de dias úteis.Não que seja difícil utilizar a contagem de dias úteis para fazer o apreçamento de instrumentos financeiros.A dificuldade é ter a contagem de dias úteis a mão e de maneira flexível, onde possamos, eventualmente, inserir ou remover feriados.Essa disponibilidade é a razão pela qual o Excel é tão utilizado."/>

    <meta property="og:title" content="bizdays - dias uteis no R" />
<meta property="og:description" content="Quem trabalha no mercado financeiro brasileiro lida constantemente com uma praga que é a contagem de dias úteis.Não que seja difícil utilizar a contagem de dias úteis para fazer o apreçamento de instrumentos financeiros.A dificuldade é ter a contagem de dias úteis a mão e de maneira flexível, onde possamos, eventualmente, inserir ou remover feriados.Essa disponibilidade é a razão pela qual o Excel é tão utilizado." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/post/2014-05-15-bizdays-dias-uteis-no-r/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2014-05-15T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2014-05-15T00:00:00&#43;00:00" />



    <title>
  bizdays - dias uteis no R · Wilson Freitas
</title>

    
      <link rel="canonical" href="http://example.org/post/2014-05-15-bizdays-dias-uteis-no-r/">
    

    <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css" integrity="sha256-2f3b/&#43;byfmmYXcX&#43;BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin="anonymous" media="screen" />
    

    

    

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    <meta name="generator" content="Hugo 0.83.1" />
  </head>

  
  
  <body class="preload-transitions colorscheme-light">
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Wilson Freitas
    </a>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="http://example.org/post/2014-05-15-bizdays-dias-uteis-no-r/">
          bizdays - dias uteis no R
        </a>
      </h1>
    </header>

    
<script src="http://example.org/post/2014-05-15-bizdays-dias-uteis-no-r/index_files/header-attrs/header-attrs.js"></script>


<p>Quem trabalha no mercado financeiro brasileiro lida constantemente com uma praga que é a contagem de dias úteis.
Não que seja difícil utilizar a contagem de dias úteis para fazer o apreçamento de instrumentos financeiros.
A dificuldade é ter a contagem de dias úteis a mão e de maneira flexível, onde possamos, eventualmente, inserir ou remover feriados.
Essa disponibilidade é a razão pela qual o Excel é tão utilizado.
Basta carregar uma lista de feriados, que hoje são disponibilizados no site da <a href="http://www.anbima.com.br" title="ANBIMA">ANBIMA</a> e são suficientes para a maioria dos instrumentos negociados no mercado brasileiro, e chamar a função <code>NETWORKDAYS</code> para calcular a quantidade de dias úteis entre duas datas de acordo com a lista de feriados.
Há ainda a função <code>WORKDAYS</code> que retorna uma data somando ou subtraindo uma quantidade de dias úteis a outra data, só que considerando uma lista de feriados.</p>
<p>Para levar essa disponibilidade ao R eu desenvolvi o pacote <a href="https://github.com/wilsonfreitas/R-bizdays" title="bizdays package"><code>bizdays</code></a>.
<code>bizdays</code> é uma pacote ridículo de simples mas que torna a minha vida muito, mas muito menos miserável, quando eu tenho que lidar com contagem de dias.
Tenho utilizado este pacote quase que diariamente no meu trabalho.
Nas próximas seções vou explicar como utilizar as funções e as idéias por trás do pacote.</p>
<div id="instalação" class="section level2">
<h2>Instalação</h2>
<p>O <code>bizdays</code> pode ser instalado das 3 formas a seguir.</p>
<div id="cran" class="section level4">
<h4>CRAN</h4>
<pre class="r"><code>install.packages(&#39;bizdays&#39;)</code></pre>
</div>
<div id="github-devtools" class="section level4">
<h4>Github + devtools</h4>
<pre class="r"><code>devtools::install_github(&#39;R-bizdays&#39;, &#39;wilsonfreitas&#39;)</code></pre>
</div>
<div id="task-view-finance" class="section level4">
<h4>Task view finance</h4>
<p>Instalando a <em>task view Finance</em> o <code>bizdays</code> vem junto no pacote.</p>
<pre class="r"><code>library(&quot;ctv&quot;)
install.views(&quot;Finance&quot;)</code></pre>
</div>
</div>
<div id="usando-bizdays" class="section level2">
<h2>Usando bizdays</h2>
<div id="criação-do-calendário" class="section level3">
<h3>Criação do calendário</h3>
<p>Toda a idéia do <code>bizdays</code> está ao redor da criação do calendário e um calendário é basicamente uma lista de feriados.
Eu disponibilizo junto com <code>bizdays</code> o <em>dataset</em> <code>holidaysANBIMA</code> que já vem com a lista de feriados disponibilizada pela <a href="http://www.anbima.com.br" title="ANBIMA">ANBIMA</a>.</p>
<pre class="r"><code>data(holidaysANBIMA, package = &#39;bizdays&#39;)
range(holidaysANBIMA)</code></pre>
<pre><code>## [1] &quot;2001-01-01&quot; &quot;2079-01-01&quot;</code></pre>
<pre class="r"><code>length(holidaysANBIMA)</code></pre>
<pre><code>## [1] 937</code></pre>
<p>Dada a lista de feriados basta executar a função <code>Calendar</code> passando a lista como argumento, mas antes vamos dar uma olhada na função <code>Calendar</code>.
A função <code>Calendar</code> tem os seguintes argumentos:</p>
<pre class="r"><code>args(create.calendar)</code></pre>
<pre><code>## function (name, holidays = integer(0), weekdays = NULL, start.date = NULL, 
##     end.date = NULL, adjust.from = adjust.none, adjust.to = adjust.none, 
##     financial = TRUE) 
## NULL</code></pre>
<p>O argumento <code>weekdays</code> define os dias não úteis da semana, em um calendário de dias úteis temos <code>weekdays=c("saturday", "sunday")</code> representando os fins de semana.
Os argumentos <code>start.date</code> e <code>end.date</code> definem os limites do calendário, no entanto, estes argumentos são utilizados apenas quando a lista de <code>holidays</code> não é fornecida, pois, quando a lista é fornecida os limites são baseados nela.
O argumento <code>dib</code> define a quantidade de dias por ano no calendário, essa configuração visa extender a utilização do calendário para a utilização de <a href="http://en.wikipedia.org/wiki/Day_count_convention">convenções de contagem de dias</a>.
Vou comentar mais sobre a utilização do argumento <code>dib</code> mais adiante.
Os argumentos <code>adjust.from</code> e <code>adjust.to</code> recebem funções para ajustar as datas <code>from</code> e <code>to</code> utilizadas na função <code>bizdays</code>.
A configuração padrão visa reproduzir a função <code>NETWORKDAYS</code> do Excel.
O argumento <code>name</code> é apenas descritivo, mas eu gosto de utilizar pois é útil quando temos diferentes calendários.</p>
<p>Vamos agora criar um calendário referente aos feriados brasileiros.</p>
<pre class="r"><code>(cal &lt;- create.calendar(holidaysANBIMA, weekdays=c(&#39;saturday&#39;, &#39;sunday&#39;), name=&#39;ANBIMA&#39;))</code></pre>
<pre><code>## ANBIMA financial calendar 
##   937 holidays 
##   2 weekdays (saturday, sunday) 
##   range from 2001-01-01 to 2079-01-01 
## bizdays arguments adjust
##   from: none 
##   to:   none</code></pre>
<p>Note que os limites do calendário foram criados com base nos limites existentes na lista de feriados.</p>
</div>
<div id="contando-dias-úteis-entre-datas" class="section level3">
<h3>Contando dias úteis entre datas</h3>
<p>Para calcular a quantidade de dias entre duas datas utilizamos a função <code>bizdays</code> passando o calendário e as datas iniciais e finais.</p>
<pre class="r"><code>args(bizdays)</code></pre>
<pre><code>## function (from, to, cal) 
## NULL</code></pre>
<pre class="r"><code>bizdays(&#39;2013-01-01&#39;, &#39;2013-12-31&#39;, cal)</code></pre>
<pre><code>## [1] 252</code></pre>
<p>Essa função aceita datas em strings no formato ISO (<code>yyyy-mm-dd</code>) ou objetos <code>Date</code>, <code>POSIXct</code> e <code>POSIXlt</code>.
Os argumentos de datas finais e iniciais também aceitam vetores.
Os vetores podem ter tamanhos diferentes, desde que respeitem a <em>recicle rule</em> do R.</p>
<pre class="r"><code>bizdays(c(&#39;2010-01-01&#39;, &#39;2011-01-01&#39;), c(&#39;2011-12-31&#39;, &#39;2012-12-31&#39;, &#39;2013-12-31&#39;, &#39;2014-12-31&#39;), cal)</code></pre>
<pre><code>## [1]  501  501 1005 1007</code></pre>
<pre class="r"><code>bizdays(c(&#39;2008-01-01&#39;, &#39;2009-01-01&#39;, &#39;2010-01-01&#39;, &#39;2011-01-01&#39;), c(&#39;2011-12-31&#39;, &#39;2012-12-31&#39;), cal)</code></pre>
<pre><code>## [1] 1005 1002  501  501</code></pre>
</div>
<div id="verificando-se-datas-são-dias-úteis" class="section level3">
<h3>Verificando se datas são dias úteis</h3>
<p>A função <code>is.bizday</code> verifica se as datas passadas no argumento são úteis.</p>
<pre class="r"><code>dates &lt;- as.Date(&#39;2014-04-14&#39;) + 0:6
is.bizday(dates, cal)</code></pre>
<pre><code>## [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE</code></pre>
</div>
<div id="adicionando-dias-úteis-as-datas" class="section level3">
<h3>Adicionando dias úteis as datas</h3>
<p>Para somar dias úteis a uma data utilizamos a função <code>add.bizdays</code> que soma dias úteis, positivos ou negativos, as datas fornecidas.</p>
<pre class="r"><code>date &lt;- &#39;2014-04-14&#39; # segunda-feira
add.bizdays(date, -1, cal)   # sexta-feira</code></pre>
<pre><code>## [1] &quot;2014-04-11&quot;</code></pre>
</div>
<div id="gerando-sequência-de-dias-úteis" class="section level3">
<h3>Gerando sequência de dias úteis</h3>
<p>Muitas vezes é necessário iterar sobre sequências de dias úteis e para isso temos a função <code>bizseq</code>.</p>
<pre class="r"><code>bizseq(&#39;2013-07-09&#39;, &#39;2013-07-21&#39;, cal)</code></pre>
<pre><code>## [1] &quot;2013-07-09&quot; &quot;2013-07-10&quot; &quot;2013-07-11&quot; &quot;2013-07-12&quot; &quot;2013-07-15&quot;
## [6] &quot;2013-07-16&quot; &quot;2013-07-17&quot; &quot;2013-07-18&quot; &quot;2013-07-19&quot;</code></pre>
<p>Todos as datas dessa sequência são dias úteis.</p>
</div>
<div id="ajustando-datas" class="section level3">
<h3>Ajustando datas</h3>
<p>Uma coisa muito comum para quem trabalha com dias úteis é o ajuste de data quando cai em dia não útil.
Por exemplo, para apreçar títulos, quando vencimento do título cai em um dia não útil é necessário mover o fluxo para o próximo dia útil.
Para lidar com isso de forma higiênica temos as funções <code>adjust.next</code> e <code>adjust.previous</code>.
Estas funções recebem uma data, se for dia útil retorna a própria data, caso contrário retorna o dia útil seguinte ou anterior, dependendo da função que foi chamada.</p>
<pre class="r"><code>adjust.next(c(&quot;2014-01-01&quot;, &quot;2014-02-01&quot;, &quot;2014-03-01&quot;, &quot;2014-04-01&quot;), cal)</code></pre>
<pre><code>## [1] &quot;2014-01-02&quot; &quot;2014-02-03&quot; &quot;2014-03-05&quot; &quot;2014-04-01&quot;</code></pre>
<p>Logo, estas funções apenas ajustam as datas fornecidas quando é necessário.</p>
</div>
<div id="configurando-o-calendário-padrão" class="section level3">
<h3>Configurando o calendário padrão</h3>
<p>Como eu falei eu uso <code>bizdays</code> em base diária e todos os dias o mesmo calendário, o calendário divulgado pela ANBIMA.
Uma coisa insuportável é criar o mesmo calendário toda vez que eu vou utilizar as funções.
Como o objetivo é reduzir a quantidade de miséria na minha vida eu criei o calendário padrão.</p>
<pre class="r"><code>bizdays.options$set(default.calendar=cal)</code></pre>
<p>Uma vez definido um calendário padrão não é mais necessário passar o calendário como argumento das funções vistas anteriormente.
Dessa maneira, as funções podem ser chamadas como:</p>
<pre class="r"><code>bizdays(&#39;2013-01-01&#39;, &#39;2013-12-31&#39;)</code></pre>
<pre><code>## [1] 252</code></pre>
<pre class="r"><code>dates &lt;- as.Date(&#39;2014-04-14&#39;) + 0:6
is.bizday(dates)</code></pre>
<pre><code>## [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE</code></pre>
<pre class="r"><code>adjust.next(c(&quot;2014-01-01&quot;, &quot;2014-02-01&quot;, &quot;2014-03-01&quot;, &quot;2014-04-01&quot;))</code></pre>
<pre><code>## [1] &quot;2014-01-02&quot; &quot;2014-02-03&quot; &quot;2014-03-05&quot; &quot;2014-04-01&quot;</code></pre>
<p>Sem a necessidade de passar o calendário como parâmetro.
Para tornar as coisa realmente simples eu coloco essa definição no <code>.Rprofile</code>.</p>
<pre class="r"><code>.First &lt;- function() {
    library(bizdays)
    cal &lt;- create.calendar(holidays=holidaysANBIMA, name=&#39;ANBIMA&#39;)
    bizdays.options$set(default.calendar=cal)
}</code></pre>
<p>Assim, toda vez que eu inicializo o R já tenho as funções do <code>bizdays</code> prontas pra utilizar.</p>
</div>
<div id="demais-funções" class="section level3">
<h3>Demais funções</h3>
<ul>
<li><code>bizyears</code>: retorno o prazo em anos referente a quantidade de dias úteis. Essa função é útil para o apreçamento de instrumentos financeiros onde usualmente as taxas são expressas com periodicidade anual. Dessa maneira, uma vez definido o calendário para a taxa é possível obter o prazo em anos para os cálculos. Por isso é útil a definição do argumento <code>dib</code>.</li>
<li><code>bizdayse</code> e <code>bizyearse</code>: <code>bizdayse</code> retorna a quantidade de dias úteis equivalente a uma quantidade de dias corridos. É equivalente a somar dias úteis a uma data e calcular os dias úteis entre as duas data utilizando <code>bizdays</code>. A função <code>bizyearse</code> é a sua versão anualizada.</li>
</ul>
</div>
</div>
<div id="conclusão" class="section level2">
<h2>Conclusão</h2>
<p>O pacote <code>bizdays</code> visa a contagem de dias para o apreçamento de instrumentos financeiros de forma simples e intuitíva de utilizar, trazendo para o R a mesma simplicidade encontrada no Excel.
É útil tanto para calendários de dias úteis quanto dias corridos, permitindo a realização destes cálculos através de uma mesma interface.</p>
</div>

  </article>
</section>

  

      </div>

      <footer class="footer">
  <section class="container">
    ©
    
    2021
    
    ·
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
  </section>
</footer>

    </main>

    
      
      <script src="/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js" integrity="sha256-A7F3afT5GuNWZ&#43;HyocqMFvUFYlds&#43;Q/zKzF5kmkU2qU="></script>
    

    

    

    

    

    

    

    

    
  </body>

</html>
